<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رفع صور بلدية بوحمدان</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: #28a745; color: white; font-weight: bold; border: none; cursor: pointer; }
        #status { color: blue; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="card">
    <h2>تطبيق رفع الصور المباشر</h2>
    <div style="margin: 10px 0; background: #eee; padding: 10px; border-radius: 5px;">
    <input type="checkbox" id="isGhar">
    <label for="isGhar">هل هذه الصورة خاصة بـ "غار جماعة"؟</label>
</div>

    <input type="file" id="fileInput" accept="image/*">
    <input type="password" id="token" placeholder="أدخل مفتاح GitHub (Token)">
    <button onclick="uploadImage()">رفع الصورة الآن</button>
    <div id="status"></div>
</div>

<script>
    async function uploadImage() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    if (!file) {
        alert("يرجى اختيار صورة أولاً!");
        return;
    }

    // 1. فحص هل المستخدم اختار "غار جماعة" أم لا
    const isGhar = document.getElementById('isGhar').checked;
    
    // 2. تحديد المجلد (إذا كان صح يرسل لـ Ghar، وإذا لا يرسل للمجلد العام)
    const folderPath = isGhar ? "Ghar/" : "";

    const fileName = encodeURIComponent(file.name);
    // 3. بناء الرابط الصحيح مع المجلد المختار
    const uploadUrl = `https://api.github.com/repos/Bcl09-lgtm/bohamdan/contents/photos/${folderPath}${fileName}`;

    const reader = new FileReader();
    reader.onload = async () => {
        const content = reader.result.split(',')[1];
        
        try {
            const response = await fetch(uploadUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': 'token YOUR_GITHUB_TOKEN', // ضع توكن الخاص بك هنا
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `رفع صورة جديدة إلى ${isGhar ? 'غار جماعة' : 'المعرض العام'}`,
                    content: content
                })
            });

            if (response.ok) {
                alert(isGhar ? "تم الرفع بنجاح إلى مجلد غار جماعة! ✅" : "تم الرفع بنجاح إلى المعرض العام! ✅");
                fileInput.value = ""; // تفريغ خانة الاختيار
                document.getElementById('isGhar').checked = false; // إلغاء تحديد المربع
            } else {
                const errorData = await response.json();
                alert("فشل الرفع: " + errorData.message);
            }
        } catch (error) {
            alert("حدث خطأ في الاتصال: " + error.message);
        }
    };
    reader.readAsDataURL(file);
}

</script>
</body>
</html>
