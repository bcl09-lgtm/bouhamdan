<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رفع صور بلدية بوحمدان</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background: #f4f7f6; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: #28a745; color: white; font-weight: bold; border: none; cursor: pointer; }
        #status { color: blue; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="card">
    <h2>تطبيق رفع الصور المباشر</h2>
    <input type="file" id="fileInput" accept="image/*">
    <input type="password" id="token" placeholder="أدخل مفتاح GitHub (Token)">
    <button onclick="uploadImage()">رفع الصورة الآن</button>
    <div id="status"></div>
</div>

<script>
async function uploadImage() {
    const fileInput = document.getElementById('fileInput');
    const token = document.getElementById('token').value;
    const status = document.getElementById('status');
    
    if (fileInput.files.length === 0 || !token) {
        alert("يرجى اختيار صورة وإدخال المفتاح");
        return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();
    
    status.innerText = "جاري التحضير...";

    reader.onload = async function() {
        const content = reader.result.split(',')[1];
        const fileName = "img_" + Date.now() + ".jpg"; // تسمية الصورة بالوقت
        
        // معلومات حسابك (يجب تعديلها)
        const owner = "bcl09-lgtm"; 
        const repo = "bouhamdan";

        status.innerText = "جاري الرفع إلى GitHub...";

        try {
            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/photos/${fileName}`, {
                method: "PUT",
                headers: {
                    "Authorization": `token ${token}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message: "إضافة صورة جديدة من الهاتف",
                    content: content
                })
            });

            if (response.ok) {
                status.innerText = "✅ تم الرفع بنجاح!";
                fileInput.value = "";
            } else {
                status.innerText = "❌ فشل الرفع. تأكد من المفتاح.";
            }
        } catch (error) {
            status.innerText = "❌ حدث خطأ في الاتصال.";
        }
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
